<p-toast />

<div class="container mx-auto p-4">
    @if (lista$ | async; as lista) {
        <p-card>
            <ng-template pTemplate="header">
                <div class="flex justify-between items-center p-4">
                    <h2 class="text-2xl font-bold">Editar Lista: {{ lista.nombre }}</h2>
                    <p-button
                        label="Cancelar"
                        icon="pi pi-times"
                        severity="secondary"
                        [text]="true"
                        (onClick)="cancelar()">
                    </p-button>
                </div>
            </ng-template>

            <form [formGroup]="listaForm" (ngSubmit)="onSubmit()">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Tipo -->
                    <div class="field">
                        <label for="tipo" class="block text-sm font-medium mb-2">
                            Tipo <span class="text-red-500">*</span>
                        </label>
                        <p-select
                            id="tipo"
                            formControlName="tipo"
                            [options]="tiposOptions"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Seleccione un tipo"
                            [showClear]="true"
                            styleClass="w-full">
                        </p-select>
                        @if (listaForm.get('tipo')?.invalid && listaForm.get('tipo')?.touched) {
                            <small class="p-error">El tipo es requerido</small>
                        }
                    </div>

                    <!-- Nombre -->
                    <div class="field">
                        <label for="nombre" class="block text-sm font-medium mb-2">
                            Nombre <span class="text-red-500">*</span>
                        </label>
                        <input
                            pInputText
                            id="nombre"
                            formControlName="nombre"
                            placeholder="Nombre de la lista"
                            class="w-full"
                            [class.ng-invalid]="listaForm.get('nombre')?.invalid && listaForm.get('nombre')?.touched" />
                        @if (listaForm.get('nombre')?.invalid && listaForm.get('nombre')?.touched) {
                            <small class="p-error">
                                @if (listaForm.get('nombre')?.errors?.['required']) {
                                    El nombre es requerido
                                } @else if (listaForm.get('nombre')?.errors?.['maxlength']) {
                                    El nombre no puede exceder 255 caracteres
                                }
                            </small>
                        }
                    </div>

                    <!-- Definici贸n -->
                    <div class="field md:col-span-2">
                        <label for="definicion" class="block text-sm font-medium mb-2">
                            Definici贸n
                        </label>
                        <textarea
                            pInputTextarea
                            id="definicion"
                            formControlName="definicion"
                            placeholder="Definici贸n de la lista"
                            [rows]="4"
                            class="w-full"
                            [class.ng-invalid]="listaForm.get('definicion')?.invalid && listaForm.get('definicion')?.touched">
                        </textarea>
                        @if (listaForm.get('definicion')?.invalid && listaForm.get('definicion')?.touched) {
                            <small class="p-error">
                                La definici贸n no puede exceder 1000 caracteres
                            </small>
                        }
                    </div>

                    <!-- Foto -->
                    <div class="field">
                        <label for="foto" class="block text-sm font-medium mb-2">
                            Foto (URL)
                        </label>
                        <input
                            pInputText
                            id="foto"
                            formControlName="foto"
                            placeholder="URL de la foto"
                            class="w-full" />
                    </div>

                    <!-- Foto Medida -->
                    <div class="field">
                        <label for="fotoMedida" class="block text-sm font-medium mb-2">
                            Foto Medida (URL)
                        </label>
                        <input
                            pInputText
                            id="fotoMedida"
                            formControlName="fotoMedida"
                            placeholder="URL de la foto de medida"
                            class="w-full" />
                    </div>
                </div>

                <p-divider />

                <div class="flex justify-end gap-2 mt-4">
                    <p-button
                        label="Cancelar"
                        icon="pi pi-times"
                        severity="secondary"
                        [text]="true"
                        (onClick)="cancelar()"
                        [disabled]="loading">
                    </p-button>
                    <p-button
                        label="Actualizar Lista"
                        icon="pi pi-check"
                        type="submit"
                        [loading]="loading"
                        [disabled]="listaForm.invalid">
                    </p-button>
                </div>
            </form>
        </p-card>
    } @else {
        <p-card>
            <div class="text-center py-8">
                <i class="pi pi-spin pi-spinner text-4xl text-gray-400 mb-2"></i>
                <p class="text-gray-600">Cargando lista...</p>
            </div>
        </p-card>
    }
</div>
