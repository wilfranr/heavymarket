<p-toast />

<div class="container mx-auto p-4">
    @if (loading$ | async) {
        <!-- Skeleton mientras carga -->
        <p-card>
            <p-skeleton height="2rem" styleClass="mb-3"></p-skeleton>
            <p-skeleton height="3rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton height="3rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton height="3rem" styleClass="mb-2"></p-skeleton>
        </p-card>
    } @else {
        <p-card>
            <ng-template pTemplate="header">
                <div class="flex justify-between items-center p-4">
                    <h2 class="text-2xl font-bold">Editar Pedido #{{ pedidoId() }}</h2>
                </div>
            </ng-template>

            <form [formGroup]="pedidoForm" (ngSubmit)="onSubmit()">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Cliente (Tercero) -->
                    <div class="col-span-1 md:col-span-2">
                        <label for="tercero_id" class="block mb-2 font-semibold">
                            Cliente <span class="text-red-500">*</span>
                        </label>
                        <p-dropdown
                            id="tercero_id"
                            formControlName="tercero_id"
                            [options]="terceros"
                            placeholder="Seleccione un cliente"
                            [filter]="true"
                            filterBy="label"
                            [showClear]="true"
                            styleClass="w-full"
                            [class.ng-invalid]="isFieldInvalid('tercero_id')"
                            [class.ng-dirty]="isFieldInvalid('tercero_id')">
                        </p-dropdown>
                        @if (isFieldInvalid('tercero_id')) {
                            <small class="text-red-500">El cliente es requerido</small>
                        }
                    </div>

                    <!-- Estado -->
                    <div>
                        <label for="estado" class="block mb-2 font-semibold">
                            Estado <span class="text-red-500">*</span>
                        </label>
                        <p-dropdown
                            id="estado"
                            formControlName="estado"
                            [options]="estadosOptions"
                            placeholder="Seleccione un estado"
                            styleClass="w-full"
                            [class.ng-invalid]="isFieldInvalid('estado')"
                            [class.ng-dirty]="isFieldInvalid('estado')">
                        </p-dropdown>
                        @if (isFieldInvalid('estado')) {
                            <small class="text-red-500">El estado es requerido</small>
                        }
                    </div>

                    <!-- Dirección -->
                    <div class="col-span-1 md:col-span-2">
                        <label for="direccion" class="block mb-2 font-semibold">
                            Dirección de Envío
                        </label>
                        <input
                            id="direccion"
                            type="text"
                            pInputText
                            formControlName="direccion"
                            placeholder="Ingrese la dirección de envío"
                            class="w-full"
                            [class.ng-invalid]="isFieldInvalid('direccion')"
                            [class.ng-dirty]="isFieldInvalid('direccion')" />
                        @if (isFieldInvalid('direccion')) {
                            <small class="text-red-500">
                                La dirección no puede exceder 500 caracteres
                            </small>
                        }
                    </div>

                    <!-- Comentario -->
                    <div class="col-span-1 md:col-span-2">
                        <label for="comentario" class="block mb-2 font-semibold">
                            Comentarios
                        </label>
                        <textarea
                            id="comentario"
                            pInputTextarea
                            formControlName="comentario"
                            placeholder="Ingrese comentarios adicionales"
                            rows="4"
                            class="w-full"
                            [class.ng-invalid]="isFieldInvalid('comentario')"
                            [class.ng-dirty]="isFieldInvalid('comentario')">
                        </textarea>
                        @if (isFieldInvalid('comentario')) {
                            <small class="text-red-500">
                                El comentario no puede exceder 1000 caracteres
                            </small>
                        }
                    </div>
                </div>

                <p-divider></p-divider>

                <!-- Botones -->
                <div class="flex justify-end gap-2">
                    <p-button
                        label="Cancelar"
                        severity="secondary"
                        icon="pi pi-times"
                        type="button"
                        (onClick)="cancelar()">
                    </p-button>
                    <p-button
                        label="Guardar Cambios"
                        icon="pi pi-save"
                        type="submit"
                        [loading]="submitting"
                        [disabled]="pedidoForm.invalid || pedidoForm.pristine">
                    </p-button>
                </div>
            </form>
        </p-card>
    }
</div>
