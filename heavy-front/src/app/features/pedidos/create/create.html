<p-toast />

<div class="container mx-auto p-4">
    <p-card>
        <ng-template pTemplate="header">
            <div class="flex justify-between items-center p-4">
                <h2 class="text-2xl font-bold">Crear Nuevo Pedido</h2>
            </div>
        </ng-template>

        <form [formGroup]="pedidoForm" (ngSubmit)="onSubmit()">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Cliente (Tercero) -->
                <div class="col-span-1 md:col-span-2">
                    <label for="tercero_id" class="block mb-2 font-semibold">
                        Cliente <span class="text-red-500">*</span>
                    </label>
                    <p-select
                        id="tercero_id"
                        formControlName="tercero_id"
                        [options]="terceros"
                        placeholder="Seleccione un cliente"
                        [filter]="true"
                        filterBy="label"
                        [showClear]="true"
                        styleClass="w-full"
                        [class.ng-invalid]="isFieldInvalid('tercero_id')"
                        [class.ng-dirty]="isFieldInvalid('tercero_id')">
                    </p-select>
                    @if (isFieldInvalid('tercero_id')) {
                        <small class="text-red-500">El cliente es requerido</small>
                    }
                </div>

                <!-- Estado -->
                <div>
                    <label for="estado" class="block mb-2 font-semibold">
                        Estado <span class="text-red-500">*</span>
                    </label>
                    <p-select
                        id="estado"
                        formControlName="estado"
                        [options]="estadosOptions"
                        placeholder="Seleccione un estado"
                        styleClass="w-full"
                        [class.ng-invalid]="isFieldInvalid('estado')"
                        [class.ng-dirty]="isFieldInvalid('estado')">
                    </p-select>
                    @if (isFieldInvalid('estado')) {
                        <small class="text-red-500">El estado es requerido</small>
                    }
                </div>

                <!-- Máquina (Opcional) -->
                <div>
                    <label for="maquina_id" class="block mb-2 font-semibold">
                        Máquina (Opcional)
                    </label>
                    <p-select
                        id="maquina_id"
                        formControlName="maquina_id"
                        [options]="maquinas"
                        placeholder="Seleccione una máquina"
                        [filter]="true"
                        [showClear]="true"
                        styleClass="w-full">
                    </p-select>
                </div>

                <!-- Dirección -->
                <div class="col-span-1 md:col-span-2">
                    <label for="direccion" class="block mb-2 font-semibold">
                        Dirección de Envío
                    </label>
                    <input
                        id="direccion"
                        type="text"
                        pInputText
                        formControlName="direccion"
                        placeholder="Ingrese la dirección de envío"
                        class="w-full"
                        [class.ng-invalid]="isFieldInvalid('direccion')"
                        [class.ng-dirty]="isFieldInvalid('direccion')" />
                    @if (isFieldInvalid('direccion')) {
                        <small class="text-red-500">
                            La dirección no puede exceder 500 caracteres
                        </small>
                    }
                </div>

                <!-- Comentario -->
                <div class="col-span-1 md:col-span-2">
                    <label for="comentario" class="block mb-2 font-semibold">
                        Comentarios
                    </label>
                    <textarea
                        id="comentario"
                        pInputTextarea
                        formControlName="comentario"
                        placeholder="Ingrese comentarios adicionales"
                        rows="4"
                        class="w-full"
                        [class.ng-invalid]="isFieldInvalid('comentario')"
                        [class.ng-dirty]="isFieldInvalid('comentario')">
                    </textarea>
                    @if (isFieldInvalid('comentario')) {
                        <small class="text-red-500">
                            El comentario no puede exceder 1000 caracteres
                        </small>
                    }
                </div>
            </div>

            <p-divider></p-divider>

            <!-- Botones -->
            <div class="flex justify-end gap-2">
                <p-button
                    label="Cancelar"
                    severity="secondary"
                    icon="pi pi-times"
                    type="button"
                    (onClick)="cancelar()">
                </p-button>
                <p-button
                    label="Crear Pedido"
                    icon="pi pi-check"
                    type="submit"
                    [loading]="loading"
                    [disabled]="pedidoForm.invalid">
                </p-button>
            </div>
        </form>
    </p-card>
</div>
